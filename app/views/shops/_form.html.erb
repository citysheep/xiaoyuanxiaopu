<%= simple_nested_form_for @shop, :html => { :class => 'form-horizontal', :multipart => true } do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">
    <%= f.input :name, :label => "小铺名称", :hint => "给自己的小铺取一个好听的名字吧" %>
    <%= f.input :description, :as => :text, :input_html => { :class => "span4", :rows => "6" }, :label => "描述", :hint => "简单描述一下自己的小铺吧" %>
    <%= f.input :lat, :as => :hidden %>
    <%= f.input :lng, :as => :hidden %>
  </div>
  <div class="row new-shop-map">
    <div class="span1">选择位置<i class="icon-map-marker"></i></div>
    <div id="new-item-map" class="span6"></div>
  </div>
  <h3>小铺货物</h3>
  <table id="items">
  <%= f.simple_fields_for :items do |item_f| %>
    <hr />
    <%= item_f.input :name, :input_html => { :class => "span4"}, :label => "货物名称" %>
    <%= item_f.input :price, :input_html => { :class => "span4"}, :label => "价格" %>
    <%= item_f.input :category_id, :label => "分类", :collection => Category.all, :default => 1, :input_html => {:class=>"select-block span3"} %>
    <%= item_f.input :photo, :input_html => { :class => "span4"}, :label => "图片" %>
    <%= item_f.input :description, :as => :text, :input_html => { :class => "span4", :rows => "6" }, :label => "描述" %>
    <%= item_f.link_to_remove "移除该货物"%>
  <% end %>
  </table>
  <p><%= f.link_to_add "再添加一个货物", :items, :data => { :target => "#items" } %></p>
  <div class="form-actions">
  <%= f.button :submit, :class => "btn-primary", :value => "提交" %>
  </div>
<% end %>
<script type = "text/javascript">
  var itemLocation = new google.maps.LatLng(<%= @shop.lat %>, <%= @shop.lng %>);
  var itemMap = new MyWebMarket.Models.Map({
    zoom: 12,
    center: itemLocation,
    location: itemLocation,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  }); 
  var itemMapView = new MyWebMarket.Views.MapView({
    model: itemMap,
    changable: false,
    clickable: true
  });
  itemMapView.eventManager.bind("mapClick", function(event){
    $("input#shop_lat").val(event.lat());
    $("input#shop_lng").val(event.lng());
  });

  $("div#new-item-map").html($(itemMapView.render().el));
</script> 